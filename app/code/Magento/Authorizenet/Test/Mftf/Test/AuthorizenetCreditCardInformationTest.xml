<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
    <test name="AuthorizenetCreditCardInformationTest">
        <annotations>
            <features value="Authorizenet"/>
            <stories value="MAGETWO-91526 - Authorize.net Direct Post does not show credit card information"/>
            <title value="Checking credit card information of Authorize.net Direct Post"/>
            <description value="Checking credit card information of Authorize.net Direct Post"/>
            <severity value="MAJOR"/>
            <testCaseId value="MAGETWO-91526"/>
            <group value="Authorizenet"/>
        </annotations>

        <before>
            <createData entity="_defaultCategory" stepKey="createCategory"/>
            <createData entity="SimpleProduct" stepKey="createProduct">
                <requiredEntity createDataKey="createCategory"/>
            </createData>
            <createData entity="Simple_US_Customer_NY" stepKey="createCustomer"/>
            <createData stepKey="setConfig" entity="AuthorizenetConfig"/>
            <magentoCLI command="cache:flush" stepKey="flushCache"/>
            <actionGroup ref="LoginAsAdmin" stepKey="LoginAsAdmin"/>
        </before>
        <after>
            <actionGroup ref="logout" stepKey="logout"/>
            <deleteData createDataKey="createCategory" stepKey="deleteProduct"/>
            <deleteData createDataKey="createProduct" stepKey="deleteCategory"/>
            <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
            <createData stepKey="setDefaultConfig" entity="AuthorizenetDefaultConfig"/>
            <createData stepKey="DisableConfigValues" entity="DisableAuthorizenetConfig"/>
        </after>
        <!--Create new order-->
        <actionGroup ref="navigateToNewOrderPageExistingCustomer" stepKey="CreateNewOrder">
            <argument name="customer" value="Simple_US_Customer_NY"/>
        </actionGroup>
        <!--Add product to order-->
        <click  selector="{{OrdersGridSection.addProducts}}" stepKey="clickToAddProduct"/>
        <waitForPageLoad stepKey="waitForProductsOpened"/>
        <click selector="{{OrdersGridSection.selectProduct($$createProduct.name$$)}}" stepKey="selectProduct"/>
        <click stepKey="addProductsToOrder" selector="{{OrdersGridSection.addProductsToOrder}}"/>
        <waitForPageLoad stepKey="waitForPageLoad"/>
        <!--Select shipping method-->
        <actionGroup ref="orderSelectFlatRateShipping" stepKey="orderSelectFlatRateShipping"/>
        <!--Fill Card data and submit order-->
        <click selector="{{AuthorizenetConfigurationSection.paymentMethod}}" stepKey="clickToSetPaymentMethod"/>
        <selectOption selector="{{AuthorizenetConfigurationSection.cardType}}" userInput="Visa" stepKey="SelectCreditCard"/>
        <fillField selector="{{AuthorizenetConfigurationSection.cardNumber}}" userInput="4111111111111111" stepKey="fillCardNumber"/>
        <selectOption selector="{{AuthorizenetConfigurationSection.month}}" userInput="01 - January" stepKey="SelectMonth"/>
        <click selector="{{AuthorizenetConfigurationSection.year}}" stepKey="clickYear"/>
        <waitForElementVisible selector="{{AuthorizenetConfigurationSection.afterTwoYear}}" stepKey="waitForDropDownMenuAppeared"/>
        <click selector="{{AuthorizenetConfigurationSection.afterTwoYear}}" stepKey="selectYear"/>
        <fillField selector="{{AuthorizenetConfigurationSection.verificationNumber}}" userInput="123" stepKey="fillVerificationNumber"/>
        <click selector="{{AdminOrderFormActionSection.SubmitOrder}}" stepKey="SubmitOrder"/>
        <waitForPageLoad stepKey="waitForPageLoad1"/>
        <!--Get order ID and open order page-->
        <see userinput="You created the order." stepKey="verifyOrderCreated"/>
        <grabTextFrom selector="|Order # (\d+)|" stepKey="getOrderId"/>
        <actionGroup ref="filterOrderGridById" stepKey="filterOrderGridById">
            <argument name="orderId" value="$getOrderId"/>
        </actionGroup>
        <click selector="{{AdminDataGridTableSection.rowViewAction('1')}}" stepKey="clickCreatedOrderInGrid"/>
        <waitForPageLoad stepKey="waitForPageLoad2"/>
        <!--Verify required data-->
        <see userinput="Credit Card Direct Post (Authorize.net)" stepKey="checkPaymentMethod"/>
        <see userinput="Credit Card Type:	MasterCard" stepKey="checkCardType"/>
        <see userinput="Credit Card Number:	XXXX1111" stepKey="checkCardCode"/>
        <see userinput="AVS Response Code:" stepKey="checkAVSResponseCode"/>
        <see userinput="Processor Authentication Code:" stepKey="checkProcessorAuthorizationCode"/>
        <see userinput="Processor Response Text:" stepKey="checkProcessorResponseText"/>
        <see userinput="CVV2 Response Code:" stepKey="checkCVVResponseCode"/>
        <see userinput="The order was placed using USD." stepKey="checkCurrency"/>
    </test>
</tests>
