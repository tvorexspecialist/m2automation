<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="../../../../../../vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/etc/testSchema.xsd">
    <test name="EndToEndB2CLoggedInUserTest">
        <!-- Step 3: User adds products to cart -->
        <comment userInput="Start of adding products to cart" stepKey="startOfAddingProductsToCart" after="endOfBrowsingCatalog"/>
        <!-- Add Simple Product 1 to cart -->
        <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="cartClickCategory" after="startOfAddingProductsToCart"/>
        <actionGroup ref="StorefrontCheckCategoryActionGroup" stepKey="cartAssertCategory" after="cartClickCategory">
            <argument name="category" value="$$createCategory$$"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="productCount" value="CONST.three"/>
        </actionGroup>
        <actionGroup ref="StorefrontCheckCategorySimpleProduct" stepKey="cartAssertSimpleProduct1" after="cartAssertCategory">
            <argument name="product" value="$$createSimpleProduct1$$"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontCategoryProductSection.ProductImageByName($$createSimpleProduct1.name$$)}}" userInput="src" stepKey="cartGrabSimpleProduct1ImageSrc" after="cartAssertSimpleProduct1"/>
        <assertNotRegExp expected="'/placeholder\/small_image\.jpg/'" actual="$cartGrabSimpleProduct1ImageSrc" stepKey="cartAssertSimpleProduct1ImageNotDefault" after="cartGrabSimpleProduct1ImageSrc"/>
        <click selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="cartClickSimpleProduct1" after="cartAssertSimpleProduct1ImageNotDefault"/>
        <actionGroup ref="StorefrontCheckSimpleProduct" stepKey="cartAssertProduct1Page" after="cartClickSimpleProduct1">
            <argument name="product" value="$$createSimpleProduct1$$"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontProductInfoMainSection.productImage}}" userInput="src" stepKey="cartGrabSimpleProduct1PageImageSrc" after="cartAssertProduct1Page"/>
        <assertNotRegExp expected="'/placeholder\/image\.jpg/'" actual="$cartGrabSimpleProduct1PageImageSrc" stepKey="cartAssertSimpleProduct1PageImageNotDefault" after="cartGrabSimpleProduct1PageImageSrc"/>
        <actionGroup ref="StorefrontAddProductToCartActionGroup" stepKey="cartAddProduct1ToCart" after="cartAssertSimpleProduct1PageImageNotDefault">
            <argument name="product" value="$$createSimpleProduct1$$"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="productCount" value="CONST.one"/>
        </actionGroup>

        <!-- Add Simple Product 2 to cart -->
        <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="cartClickCategory1" after="cartAddProduct1ToCart"/>
        <actionGroup ref="StorefrontCheckCategoryActionGroup" stepKey="cartAssertCategory1ForSimpleProduct2" after="cartClickCategory1">
            <argument name="category" value="$$createCategory$$"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="productCount" value="CONST.three"/>
        </actionGroup>
        <actionGroup ref="StorefrontCheckCategorySimpleProduct" stepKey="cartAssertSimpleProduct2" after="cartAssertCategory1ForSimpleProduct2">
            <argument name="product" value="$$createSimpleProduct2$$"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontCategoryProductSection.ProductImageByName($$createSimpleProduct2.name$$)}}" userInput="src" stepKey="cartGrabSimpleProduct2ImageSrc" after="cartAssertSimpleProduct2"/>
        <assertNotRegExp expected="'/placeholder\/small_image\.jpg/'" actual="$cartGrabSimpleProduct2ImageSrc" stepKey="cartAssertSimpleProduct2ImageNotDefault" after="cartGrabSimpleProduct2ImageSrc"/>
        <actionGroup ref="StorefrontAddCategoryProductToCartActionGroup" stepKey="cartAddProduct2ToCart" after="cartAssertSimpleProduct2ImageNotDefault">
            <argument name="product" value="$$createSimpleProduct2$$"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="productCount" value="CONST.two"/>
        </actionGroup>

        <!-- Check products in minicart -->
        <!-- Check simple product1 in minicart -->
        <actionGroup ref="StorefrontOpenMinicartAndCheckSimpleProductActionGroup" stepKey="cartOpenMinicartAndCheckSimpleProduct1" after="cartAddProduct2ToCart">
            <argument name="product" value="$$createSimpleProduct1$$"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontMinicartSection.productImageByName($$createSimpleProduct1.name$$)}}" userInput="src" stepKey="cartMinicartGrabSimpleProduct1ImageSrc" after="cartOpenMinicartAndCheckSimpleProduct1"/>
        <assertNotRegExp expected="'/placeholder\/thumbnail\.jpg/'" actual="$cartMinicartGrabSimpleProduct1ImageSrc" stepKey="cartMinicartAssertSimpleProduct1ImageNotDefault" after="cartMinicartGrabSimpleProduct1ImageSrc"/>
        <click selector="{{StorefrontMinicartSection.productLinkByName($$createSimpleProduct1.name$$)}}" stepKey="cartMinicartClickSimpleProduct1" after="cartMinicartAssertSimpleProduct1ImageNotDefault"/>
        <actionGroup ref="StorefrontCheckSimpleProduct" stepKey="cartAssertMinicartProduct1Page" after="cartMinicartClickSimpleProduct1">
            <argument name="product" value="$$createSimpleProduct1$$"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontProductInfoMainSection.productImage}}" userInput="src" stepKey="cartMinicartGrabSimpleProduct1PageImageSrc" after="cartAssertMinicartProduct1Page"/>
        <assertNotRegExp expected="'/placeholder\/image\.jpg/'" actual="$cartMinicartGrabSimpleProduct1PageImageSrc" stepKey="cartMinicartAssertSimpleProduct1PageImageNotDefault" after="cartMinicartGrabSimpleProduct1PageImageSrc"/>
        <actionGroup ref="StorefrontOpenMinicartAndCheckSimpleProductActionGroup" stepKey="cartOpenMinicartAndCheckSimpleProduct2" after="cartMinicartAssertSimpleProduct1PageImageNotDefault">
            <argument name="product" value="$$createSimpleProduct2$$"/>
        </actionGroup>
        <!-- Check simple product2 in minicart -->
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontMinicartSection.productImageByName($$createSimpleProduct2.name$$)}}" userInput="src" stepKey="cartMinicartGrabSimpleProduct2ImageSrc" after="cartOpenMinicartAndCheckSimpleProduct2"/>
        <assertNotRegExp expected="'/placeholder\/thumbnail\.jpg/'" actual="$cartMinicartGrabSimpleProduct2ImageSrc" stepKey="cartMinicartAssertSimpleProduct2ImageNotDefault" after="cartMinicartGrabSimpleProduct2ImageSrc"/>
        <click selector="{{StorefrontMinicartSection.productLinkByName($$createSimpleProduct2.name$$)}}" stepKey="cartMinicartClickSimpleProduct2" after="cartMinicartAssertSimpleProduct2ImageNotDefault"/>
        <actionGroup ref="StorefrontCheckSimpleProduct" stepKey="cartAssertMinicartProduct2Page" after="cartMinicartClickSimpleProduct2">
            <argument name="product" value="$$createSimpleProduct2$$"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontProductInfoMainSection.productImage}}" userInput="src" stepKey="cartMinicartGrabSimpleProduct2PageImageSrc" after="cartAssertMinicartProduct2Page"/>
        <assertNotRegExp expected="'/placeholder\/image\.jpg/'" actual="$cartMinicartGrabSimpleProduct2PageImageSrc" stepKey="cartMinicartAssertSimpleProduct2PageImageNotDefault" after="cartMinicartGrabSimpleProduct2PageImageSrc"/>

        <!-- Check products in cart -->
        <actionGroup ref="StorefrontOpenCartFromMinicartActionGroup" stepKey="cartOpenCart" after="cartMinicartAssertSimpleProduct2PageImageNotDefault"/>
        <actionGroup ref="StorefrontCheckCartActionGroup" stepKey="cartAssertCart" after="cartOpenCart">
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="subtotal" value="E2EB2CQuote.subtotal"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="shipping" value="E2EB2CQuote.shipping"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="shippingMethod" value="E2EB2CQuote.shippingMethod"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="total" value="E2EB2CQuote.total"/>
        </actionGroup>

        <!-- Check simple product1 in cart -->
        <actionGroup ref="StorefrontCheckCartSimpleProductActionGroup" stepKey="cartAssertCartSimpleProduct1" after="cartAssertCart">
            <argument name="product" value="$$createSimpleProduct1$$"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="productQuantity" value="CONST.one"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{CheckoutCartProductSection.ProductImageByName($$createSimpleProduct1.name$$)}}" userInput="src" stepKey="cartCartGrabSimpleProduct1ImageSrc" after="cartAssertCartSimpleProduct1"/>
        <assertNotRegExp expected="'/placeholder\/small_image\.jpg/'" actual="$cartCartGrabSimpleProduct1ImageSrc" stepKey="cartCartAssertSimpleProduct1ImageNotDefault" after="cartCartGrabSimpleProduct1ImageSrc"/>
        <click selector="{{CheckoutCartProductSection.ProductLinkByName($$createSimpleProduct1.name$$)}}" stepKey="cartClickCartSimpleProduct1" after="cartCartAssertSimpleProduct1ImageNotDefault"/>
        <actionGroup ref="StorefrontCheckSimpleProduct" stepKey="cartAssertCartProduct1Page" after="cartClickCartSimpleProduct1">
            <argument name="product" value="$$createSimpleProduct1$$"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontProductInfoMainSection.productImage}}" userInput="src" stepKey="cartCartGrabSimpleProduct2PageImageSrc1" after="cartAssertCartProduct1Page"/>
        <assertNotRegExp expected="'/placeholder\/image\.jpg/'" actual="$cartCartGrabSimpleProduct2PageImageSrc1" stepKey="cartCartAssertSimpleProduct2PageImageNotDefault1" after="cartCartGrabSimpleProduct2PageImageSrc1"/>

        <!-- Check simple product2 in cart -->
        <actionGroup ref="StorefrontOpenCartFromMinicartActionGroup" stepKey="cartOpenCart1" after="cartCartAssertSimpleProduct2PageImageNotDefault1"/>
        <actionGroup ref="StorefrontCheckCartSimpleProductActionGroup" stepKey="cartAssertCartSimpleProduct2" after="cartOpenCart1">
            <argument name="product" value="$$createSimpleProduct2$$"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="productQuantity" value="CONST.one"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{CheckoutCartProductSection.ProductImageByName($$createSimpleProduct2.name$$)}}" userInput="src" stepKey="cartCartGrabSimpleProduct2ImageSrc" after="cartAssertCartSimpleProduct2"/>
        <assertNotRegExp expected="'/placeholder\/small_image\.jpg/'" actual="$cartCartGrabSimpleProduct2ImageSrc" stepKey="cartCartAssertSimpleProduct2ImageNotDefault" after="cartCartGrabSimpleProduct2ImageSrc"/>
        <click selector="{{CheckoutCartProductSection.ProductLinkByName($$createSimpleProduct2.name$$)}}" stepKey="cartClickCartSimpleProduct2" after="cartCartAssertSimpleProduct2ImageNotDefault"/>
        <actionGroup ref="StorefrontCheckSimpleProduct" stepKey="cartAssertCartProduct2Page" after="cartClickCartSimpleProduct2">
            <argument name="product" value="$$createSimpleProduct2$$"/>
        </actionGroup>
        <!-- @TODO: Move Image check to action group after MQE-697 is fixed -->
        <grabAttributeFrom selector="{{StorefrontProductInfoMainSection.productImage}}" userInput="src" stepKey="cartCartGrabSimpleProduct2PageImageSrc2" after="cartAssertCartProduct2Page"/>
        <assertNotRegExp expected="'/placeholder\/image\.jpg/'" actual="$cartCartGrabSimpleProduct2PageImageSrc2" stepKey="cartCartAssertSimpleProduct2PageImageNotDefault2" after="cartCartGrabSimpleProduct2PageImageSrc2"/>
        <comment userInput="End of adding products to cart" stepKey="endOfAddingProductsToCart" after="cartCartAssertSimpleProduct2PageImageNotDefault2" />

        <!-- Step 7: Check out -->
        <comment userInput="Start of checking out" stepKey="startOfCheckingOut" after="endOfUsingCouponCode" />
        <actionGroup ref="GoToCheckoutFromMinicartActionGroup" stepKey="goToCheckoutFromMinicart" after="startOfCheckingOut"/>
        <actionGroup ref="LoggedInUserCheckoutFillingShippingSectionActionGroup" stepKey="checkoutFillingShippingSection" after="goToCheckoutFromMinicart">
            <argument name="customerVar" value="CustomerEntityOne" />
            <argument name="customerAddressVar" value="CustomerAddressSimple" />
        </actionGroup>

        <!-- Check order summary in checkout -->
        <actionGroup ref="CheckOrderSummaryInCheckoutActionGroup" stepKey="checkoutCheckOrderSummary" after="checkoutFillingShippingSection">
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="subtotal" value="E2EB2CQuote.subtotal"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="shippingTotal" value="E2EB2CQuote.shipping"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="shippingMethod" value="E2EB2CQuote.shippingMethod"/>
            <!-- @TODO: Change to scalar value after MQE-498 is implemented -->
            <argument name="total" value="E2EB2CQuote.total"/>
        </actionGroup>

        <!-- Check ship to information in checkout -->
        <actionGroup ref="CheckShipToInformationInCheckoutActionGroup" stepKey="checkoutCheckShipToInformation" after="checkoutCheckOrderSummary">
            <argument name="customerVar" value="CustomerEntityOne" />
            <argument name="customerAddressVar" value="CustomerAddressSimple" />
        </actionGroup>

        <!-- Check shipping method in checkout -->
        <actionGroup ref="CheckShippingMethodInCheckoutActionGroup" stepKey="checkoutCheckShippingMethod" after="checkoutCheckShipToInformation">
            <argument name="shippingMethod" value="E2EB2CQuote.shippingMethod" />
        </actionGroup>

        <!-- Verify Simple Product 1 is in checkout cart items -->
        <actionGroup ref="CheckProductInCheckoutCartItemsActionGroup" stepKey="checkoutCheckSimpleProduct1InCartItems" after="checkoutCheckShippingMethod">
            <argument name="productVar" value="$$createSimpleProduct1$$"/>
        </actionGroup>

        <!-- Verify Simple Product 2 is in checkout cart items -->
        <actionGroup ref="CheckProductInCheckoutCartItemsActionGroup" stepKey="checkoutCheckSimpleProduct2InCartItems" after="checkoutCheckSimpleProduct1InCartItems">
            <argument name="productVar" value="$$createSimpleProduct2$$"/>
        </actionGroup>

        <actionGroup ref="CheckoutSelectCheckMoneyOrderPaymentActionGroup" stepKey="selectCheckMoneyOrderPayment" after="checkoutCheckSimpleProduct2InCartItems"/>
        <actionGroup ref="CheckBillingAddressInCheckoutActionGroup" stepKey="seeBillingAddress" after="selectCheckMoneyOrderPayment">
            <argument name="customerVar" value="CustomerEntityOne" />
            <argument name="customerAddressVar" value="CustomerAddressSimple" />
        </actionGroup>
        <actionGroup ref="CheckoutPlaceOrderActionGroup" stepKey="placeorder" after="seeBillingAddress">
            <argument name="orderNumberMessage" value="CONST.successCheckoutOrderNumberMessage" />
            <argument name="emailYouMessage" value="CONST.successCheckoutEmailYouMessage" />
        </actionGroup>
        <comment userInput="End of checking out" stepKey="endOfCheckingOut" after="placeorder" />
    </test>
</tests>
