<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="../../../../../../vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/etc/testSchema.xsd">
    <cest name="End2EndB2CUserCest">
        <annotations>
            <features value="End to End scenarios"/>
            <stories value="B2C - User"/>
            <group value="end2end"/>
            <env value="chrome"/>
            <env value="firefox"/>
            <env value="phantomjs"/>
        </annotations>
        <before>
            <createData entity="_defaultCategory" mergeKey="createCategory"/>
            <createData entity="_defaultProduct" mergeKey="createSimpleProduct1">
                <required-entity persistedKey="createCategory"/>
            </createData>
            <createData entity="_defaultProduct" mergeKey="createSimpleProduct2">
                <required-entity persistedKey="createCategory"/>
            </createData>
            <!--<createData entity="ConfigurableProductOne" mergeKey="createConfigurableProduct">-->
                <!--<required-entity persistedKey="createCategory"/>-->
            <!--</createData>-->
        </before>
        <after>
            <deleteData createDataKey="createCategory" mergeKey="deleteCategory"/>
            <deleteData createDataKey="createSimpleProduct1" mergeKey="deleteSimpleProduct1"/>
            <deleteData createDataKey="createSimpleProduct2" mergeKey="deleteSimpleProduct2"/>
            <!--<deleteData createDataKey="createConfigurableProduct" mergeKey="deleteConfigurableProduct"/>-->
        </after>
        <test name="End2EndB2CUser">
            <annotations>
                <title value="You should be able to pass End to End B2C User scenario"/>
                <description value="User browses catalog, searches for product, adds product to cart, adds product to wishlist, compares products, uses coupon code and checks out."/>
                <severity value="CRITICAL"/>
                <testCaseId value="MAGETWO-75411"/>
            </annotations>
            <!-- Step 1: User browses catalog -->
            <amOnPage url="{{StorefrontHomePage}}" mergeKey="amOnHomePage"/>

            <!-- Open Category -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" mergeKey="browseClickCategory" />
            <seeInTitle userInput="$$createCategory.name$$" mergeKey="browseAssertCategoryNameTitle"/>
            <see userInput="$$createCategory.name$$" selector="{{StorefrontCategoryMainSection.CategoryTitle}}" mergeKey="browseAssertCategoryName"/>
            <see userInput="2" selector="{{StorefrontCategoryMainSection.productCount}} span" mergeKey="browseAssertCategoryProductCount"/>
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('1')}}" mergeKey="browseAssertCategorySimpleProduct1Name"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByNumber('1')}}" mergeKey="browseAssertCategorySimpleProduct1Price"/>
            <see userInput="$$createSimpleProduct2.name$$" selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('2')}}" mergeKey="browseAssertCategorySimpleProduct2Name"/>
            <see userInput="$$$createSimpleProduct2.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByNumber('2')}}" mergeKey="browseAssertCategorySimpleProduct2Price"/>

            <!-- View Simple Product 1 -->
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('1')}}" mergeKey="browseClickCategorySimpleProduct1View" />
            <seeInTitle userInput="$$createSimpleProduct1.name$$" mergeKey="browseAssertSimpleProduct1NameTitle"/>
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" mergeKey="browseAssertSimpleProduct1Name"/>
            <see userInput="$$createSimpleProduct1.sku$$" selector="{{StorefrontProductInfoMainSection.productSku}}" mergeKey="browseAssertSimpleProduct1Sku"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontProductInfoMainSection.productPrice}}" mergeKey="browseAssertSimpleProduct1Price"/>
            <see userInput="IN STOCK" selector="{{StorefrontProductInfoMainSection.productStockStatus}}" mergeKey="browseAssertSimpleProduct1Stock"/>

            <!-- View Simple Product 2 -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" mergeKey="browseClickCategory1" />
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('2')}}" mergeKey="browseClickCategorySimpleProduct2View" />
            <seeInTitle userInput="$$createSimpleProduct2.name$$" mergeKey="browseAssertSimpleProduct2NameTitle"/>
            <see userInput="$$createSimpleProduct2.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" mergeKey="browseAssertSimpleProduct2Name"/>
            <see userInput="$$createSimpleProduct2.sku$$" selector="{{StorefrontProductInfoMainSection.productSku}}" mergeKey="browseAssertSimpleProduct2Sku"/>
            <see userInput="$$$createSimpleProduct2.price$$.00" selector="{{StorefrontProductInfoMainSection.productPrice}}" mergeKey="browseAssertSimpleProduct2Price"/>
            <see userInput="IN STOCK" selector="{{StorefrontProductInfoMainSection.productStockStatus}}" mergeKey="browseAssertSimpleProduct2Stock"/>

            <!-- Step 2: User searches for product -->
            <!-- Quick Search with Product 1 Name -->
            <fillField userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontQuickSearchSection.searchPhrase}}" mergeKey="searchFillQuickSearch"/>
            <click selector="{{StorefrontQuickSearchSection.searchButton}}" mergeKey="searchClickQuickSearchButton" />
            <seeInTitle userInput="Search results for: '$$createSimpleProduct1.name$$'" mergeKey="searchAssertQuickSearchTitle"/>
            <see userInput="Search results for: '$$createSimpleProduct1.name$$'" selector="{{StorefrontQuickSearchMainSection.SearchTitle}}" mergeKey="searchAssertQuickSearchName"/>
            <see userInput="1" selector="{{StorefrontQuickSearchMainSection.productCount}} span" mergeKey="searchAssertProductCount"/>
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('1')}}" mergeKey="searchAssertSimpleProduct1Name"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByNumber('1')}}" mergeKey="searchAssertSimpleProduct1Price"/>
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('1')}}" mergeKey="searchClickSimpleProduct1View"/>
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" mergeKey="searchAssertSimpleProduct1PageName"/>

            <!-- Quick Search with common part of product names -->
            <fillField userInput="testProductName" selector="{{StorefrontQuickSearchSection.searchPhrase}}" mergeKey="searchFillQuickSearchCommonPart"/>
            <click selector="{{StorefrontQuickSearchSection.searchButton}}" mergeKey="searchClickQuickSearchButtonCommonPart" />
            <seeInTitle userInput="Search results for: 'testProductName'" mergeKey="searchAssertQuickSearchTitleCommonPart"/>
            <see userInput="Search results for: 'testProductName'" selector="{{StorefrontQuickSearchMainSection.SearchTitle}}" mergeKey="searchAssertQuickSearchNameCommonPart"/>
            <click selector="{{StorefrontCategoryFilterSection.CategoryFilter}}" mergeKey="searchClickCategoryFilterTitleCommonPart" />
            <click selector="{{StorefrontCategoryFilterSection.CategoryByName($$createCategory.name$$)}}" mergeKey="searchClickCategoryFilterCommonPart" />
            <see userInput="2" selector="{{StorefrontCategoryMainSection.productCount}} span" mergeKey="searchAssertCategoryProductCount"/>
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('1')}}" mergeKey="searchAssertCategorySimpleProduct1Name"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByNumber('1')}}" mergeKey="searchAssertCategorySimpleProduct1Price"/>
            <see userInput="$$createSimpleProduct2.name$$" selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('2')}}" mergeKey="searchAssertCategorySimpleProduct2Name"/>
            <see userInput="$$$createSimpleProduct2.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByNumber('2')}}" mergeKey="searchAssertCategorySimpleProduct2Price"/>
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('2')}}" mergeKey="searchClickSimpleProduct2View"/>
            <see userInput="$$createSimpleProduct2.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" mergeKey="searchAssertSimpleProduct2PageName"/>

            <!-- Quick Search with non-existent product name -->
            <fillField userInput="nonexistent$$createSimpleProduct1.name$$nonexistent" selector="{{StorefrontQuickSearchSection.searchPhrase}}" mergeKey="searchFillQuickSearchNonExistent"/>
            <click selector="{{StorefrontQuickSearchSection.searchButton}}" mergeKey="searchClickQuickSearchButtonNonExistent" />
            <seeInTitle userInput="Search results for: 'nonexistent$$createSimpleProduct1.name$$nonexistent'" mergeKey="searchAssertQuickSearchTitleNonExistent"/>
            <seeInTitle userInput="Search results for: 'nonexistent$$createSimpleProduct1.name$$nonexistent'" mergeKey="searchAssertQuickSearchTitleNonExistent"/>
            <see userInput="Search results for: 'nonexistent$$createSimpleProduct1.name$$nonexistent'" selector="{{StorefrontQuickSearchMainSection.SearchTitle}}" mergeKey="searchAssertQuickSearchNameNonExistent"/>
            <see userInput="Your search returned no results." selector="{{StorefrontQuickSearchMainSection.message}}" mergeKey="searchAssertQuickSearchMessageNonExistent"/>

            <!-- Step 3 -->
            <!-- Add Simple Product 1 to cart -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" mergeKey="cartClickCategory" />
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByNumber('1')}}" mergeKey="cartClickSimpleProduct1"/>
            <click selector="{{StorefrontProductInfoMainSection.AddToCart}}" mergeKey="cartClickAddSimpleProduct1ToCart" />
            <!-- Add Simple Product 2 to cart -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" mergeKey="cartClickCategory1" />
            <moveMouseOver selector="{{StorefrontCategoryProductSection.ProductInfoByNumber('2')}}" mergeKey="cartMoveMouseOverSimpleProduct2" />
            <click selector="{{StorefrontCategoryProductSection.ProductAddToCartByNumber('2')}}" mergeKey="cartClickAddSimpleProduct2ToCart" />

        </test>
    </cest>
</config>
