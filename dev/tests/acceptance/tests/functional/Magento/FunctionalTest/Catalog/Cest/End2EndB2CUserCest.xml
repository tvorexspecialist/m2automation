<?xml version="1.0" encoding="UTF-8"?>
<!--
 /**
  * Copyright Â© Magento, Inc. All rights reserved.
  * See COPYING.txt for license details.
  */
-->

<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="../../../../../../vendor/magento/magento2-functional-testing-framework/src/Magento/FunctionalTestingFramework/Test/etc/testSchema.xsd">
    <cest name="End2EndB2CUserCest">
        <annotations>
            <features value="End to End scenarios"/>
            <stories value="B2C - User"/>
            <group value="end2end"/>
            <env value="chrome"/>
            <env value="firefox"/>
            <env value="phantomjs"/>
        </annotations>
        <before>
            <resetCookie userInput="PHPSESSID" stepKey="resetCookieForCart"/>
            <createData entity="_defaultCategory" stepKey="createCategory"/>
            <createData entity="_defaultProduct" stepKey="createSimpleProduct1">
                <required-entity createDataKey="createCategory"/>
            </createData>
            <createData entity="_defaultProduct" stepKey="createSimpleProduct2">
                <required-entity createDataKey="createCategory"/>
            </createData>
            <createData entity="_defaultCategory" stepKey="createCategory1"/>
            <createData entity="_defaultProduct" stepKey="createSimpleProduct11">
                <required-entity createDataKey="createCategory1"/>
            </createData>
            <createData entity="_defaultApiSalesRule" stepKey="createSalesRule"/>
            <createData entity="_defaultApiSalesRuleCoupon" stepKey="createSalesRuleCoupon">
                <required-entity createDataKey="createSalesRule"/>
            </createData>
        </before>
        <after>
            <deleteData createDataKey="createCategory" stepKey="deleteCategory"/>
            <deleteData createDataKey="createCategory1" stepKey="deleteCategory1"/>
            <deleteData createDataKey="createSimpleProduct1" stepKey="deleteSimpleProduct1"/>
            <deleteData createDataKey="createSimpleProduct2" stepKey="deleteSimpleProduct2"/>
            <deleteData createDataKey="createSimpleProduct11" stepKey="deleteSimpleProduct11"/>
            <deleteData createDataKey="createSalesRule" stepKey="deleteSalesRule"/>
        </after>
        <test name="End2EndB2CUser">
            <annotations>
                <title value="You should be able to pass End to End B2C User scenario"/>
                <description value="User browses catalog, searches for product, adds product to cart, adds product to wishlist, compares products, uses coupon code and checks out."/>
                <severity value="CRITICAL"/>
                <testCaseId value="MAGETWO-75411"/>
            </annotations>
            <!-- Step 1: User browses catalog -->
            <amOnPage url="{{StorefrontHomePage}}" stepKey="amOnHomePage"/>

            <!-- Open Category -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="browseClickCategory" />
            <seeInTitle userInput="$$createCategory.name$$" stepKey="browseAssertCategoryNameTitle"/>
            <see userInput="$$createCategory.name$$" selector="{{StorefrontCategoryMainSection.CategoryTitle}}" stepKey="browseAssertCategoryName"/>
            <see userInput="2" selector="{{StorefrontCategoryMainSection.productCount}} span" stepKey="browseAssertCategoryProductCount"/>
            <seeElement selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="browseAssertCategorySimpleProduct1Name"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByName($$createSimpleProduct1.name$$)}}" stepKey="browseAssertCategorySimpleProduct1Price"/>
            <seeElement selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct2.name$$)}}" stepKey="browseAssertCategorySimpleProduct2Name"/>
            <see userInput="$$$createSimpleProduct2.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByName($$createSimpleProduct1.name$$)}}" stepKey="browseAssertCategorySimpleProduct2Price"/>

            <!-- View Simple Product 1 -->
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="browseClickCategorySimpleProduct1View" />
            <seeInTitle userInput="$$createSimpleProduct1.name$$" stepKey="browseAssertSimpleProduct1NameTitle"/>
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" stepKey="browseAssertSimpleProduct1Name"/>
            <see userInput="$$createSimpleProduct1.sku$$" selector="{{StorefrontProductInfoMainSection.productSku}}" stepKey="browseAssertSimpleProduct1Sku"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontProductInfoMainSection.productPrice}}" stepKey="browseAssertSimpleProduct1Price"/>
            <see userInput="IN STOCK" selector="{{StorefrontProductInfoMainSection.productStockStatus}}" stepKey="browseAssertSimpleProduct1Stock"/>

            <!-- View Simple Product 2 -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="browseClickCategory1" />
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct2.name$$)}}" stepKey="browseClickCategorySimpleProduct2View" />
            <seeInTitle userInput="$$createSimpleProduct2.name$$" stepKey="browseAssertSimpleProduct2NameTitle"/>
            <see userInput="$$createSimpleProduct2.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" stepKey="browseAssertSimpleProduct2Name"/>
            <see userInput="$$createSimpleProduct2.sku$$" selector="{{StorefrontProductInfoMainSection.productSku}}" stepKey="browseAssertSimpleProduct2Sku"/>
            <see userInput="$$$createSimpleProduct2.price$$.00" selector="{{StorefrontProductInfoMainSection.productPrice}}" stepKey="browseAssertSimpleProduct2Price"/>
            <see userInput="IN STOCK" selector="{{StorefrontProductInfoMainSection.productStockStatus}}" stepKey="browseAssertSimpleProduct2Stock"/>

            <!-- Step 2: User searches for product -->
            <!-- Quick Search with Product 1 Name -->
            <fillField userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontQuickSearchSection.searchPhrase}}" stepKey="searchFillQuickSearch"/>
            <click selector="{{StorefrontQuickSearchSection.searchButton}}" stepKey="searchClickQuickSearchButton" />
            <seeInTitle userInput="Search results for: '$$createSimpleProduct1.name$$'" stepKey="searchAssertQuickSearchTitle"/>
            <see userInput="Search results for: '$$createSimpleProduct1.name$$'" selector="{{StorefrontQuickSearchMainSection.SearchTitle}}" stepKey="searchAssertQuickSearchName"/>
            <see userInput="1" selector="{{StorefrontQuickSearchMainSection.productCount}} span" stepKey="searchAssertProductCount"/>
            <seeElement selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="searchAssertSimpleProduct1Name"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByName($$createSimpleProduct1.name$$   )}}" stepKey="searchAssertSimpleProduct1Price"/>
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="searchClickSimpleProduct1View"/>
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" stepKey="searchAssertSimpleProduct1PageName"/>

            <!-- Quick Search with common part of product names -->
            <fillField userInput="testProductName" selector="{{StorefrontQuickSearchSection.searchPhrase}}" stepKey="searchFillQuickSearchCommonPart"/>
            <click selector="{{StorefrontQuickSearchSection.searchButton}}" stepKey="searchClickQuickSearchButtonCommonPart" />
            <seeInTitle userInput="Search results for: 'testProductName'" stepKey="searchAssertQuickSearchTitleCommonPart"/>
            <see userInput="Search results for: 'testProductName'" selector="{{StorefrontQuickSearchMainSection.SearchTitle}}" stepKey="searchAssertQuickSearchNameCommonPart"/>
            <click selector="{{StorefrontCategoryFilterSection.CategoryFilter}}" stepKey="searchClickCategoryFilterTitleCommonPart" />
            <scrollTo selector="{{StorefrontCategoryFilterSection.CategoryByName($$createCategory.name$$)}}" stepKey="searchScrollToClickCategoryFilterCommonPart"/>
            <click selector="{{StorefrontCategoryFilterSection.CategoryByName($$createCategory.name$$)}}" stepKey="searchClickCategoryFilterCommonPart" />
            <see userInput="2" selector="{{StorefrontCategoryMainSection.productCount}} span" stepKey="searchAssertCategoryProductCount"/>
            <seeElement selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="searchAssertCategorySimpleProduct1Name"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByName($$createSimpleProduct1.name$$)}}" stepKey="searchAssertCategorySimpleProduct1Price"/>
            <seeElement selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct2.name$$)}}" stepKey="searchAssertCategorySimpleProduct2Name"/>
            <see userInput="$$$createSimpleProduct2.price$$.00" selector="{{StorefrontCategoryProductSection.ProductPriceByName($$createSimpleProduct2.name$$)}}" stepKey="searchAssertCategorySimpleProduct2Price"/>
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct2.name$$)}}" stepKey="searchClickSimpleProduct2View"/>
            <see userInput="$$createSimpleProduct2.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" stepKey="searchAssertSimpleProduct2PageName"/>

            <!-- Quick Search with non-existent product name -->
            <fillField userInput="nonexistent$$createSimpleProduct1.name$$nonexistent" selector="{{StorefrontQuickSearchSection.searchPhrase}}" stepKey="searchFillQuickSearchNonExistent"/>
            <click selector="{{StorefrontQuickSearchSection.searchButton}}" stepKey="searchClickQuickSearchButtonNonExistent" />
            <seeInTitle userInput="Search results for: 'nonexistent$$createSimpleProduct1.name$$nonexistent'" stepKey="searchAssertQuickSearchTitleNonExistent"/>
            <see userInput="Search results for: 'nonexistent$$createSimpleProduct1.name$$nonexistent'" selector="{{StorefrontQuickSearchMainSection.SearchTitle}}" stepKey="searchAssertQuickSearchNameNonExistent"/>
            <see userInput="Your search returned no results." selector="{{StorefrontQuickSearchMainSection.message}}" stepKey="searchAssertQuickSearchMessageNonExistent"/>

            <!-- Step 3: User adds products to cart -->
            <!-- Add Simple Product 1 to cart -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="cartClickCategory" />
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="cartClickSimpleProduct1"/>
            <click selector="{{StorefrontProductInfoMainSection.AddToCart}}" stepKey="cartClickAddSimpleProduct1ToCart" />
            <waitForElement selector="{{StorefrontMessageSection.message('You added $$createSimpleProduct1.name$$ to your shopping cart.')}}" time="30" stepKey="cartMessageSimpleProduct1AddedToCart"/>

            <!-- Add Simple Product 2 to cart -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="cartClickCategory1" />
            <moveMouseOver selector="{{StorefrontCategoryProductSection.ProductInfoByName($$createSimpleProduct2.name$$)}}" stepKey="cartMoveMouseOverSimpleProduct2" />
            <click selector="{{StorefrontCategoryProductSection.ProductAddToCartByName($$createSimpleProduct2.name$$)}}" stepKey="cartClickAddSimpleProduct2ToCart" />
            <waitForElement selector="{{StorefrontMessageSection.message('You added $$createSimpleProduct2.name$$ to your shopping cart.')}}" time="30" stepKey="cartMessageSimpleProduct2AddedToCart"/>

            <!-- Check products in minicart -->
            <waitForElement selector="{{StorefrontMinicartSection.ProductLinkByName($$createSimpleProduct1.name$$)}}" stepKey="cartWaitForMinicartSimpleProduct1" />
            <click selector="{{StorefrontMinicartSection.ShowCart}}" stepKey="cartClickShowMinicart" />
            <click selector="{{StorefrontMinicartSection.ProductLinkByName($$createSimpleProduct1.name$$)}}" stepKey="cartClickMinicartSimpleProduct1" />
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" stepKey="cartAssertMinicartSimpleProduct1Name"/>
            <waitForElement selector="{{StorefrontMinicartSection.ProductLinkByName($$createSimpleProduct2.name$$)}}" stepKey="cartWaitForMinicartSimpleProduct2" />
            <click selector="{{StorefrontMinicartSection.ShowCart}}" stepKey="cartClickShowMinicart1" />
            <click selector="{{StorefrontMinicartSection.ProductLinkByName($$createSimpleProduct2.name$$)}}" stepKey="cartClickMinicartSimpleProduct2" />
            <see userInput="$$createSimpleProduct2.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" stepKey="cartAssertMinicartSimpleProduct2Name"/>

            <!-- Check products in cart -->
            <amOnPage url="{{CheckoutCartPage}}" stepKey="cartOnCheckoutCart"/>
            <seeElement selector="{{CheckoutCartProductSection.ProductLinkByName($$createSimpleProduct1.name$$)}}" stepKey="cartAssertCartSimpleProduct1Name"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{CheckoutCartProductSection.ProductPriceByName($$createSimpleProduct1.name$$)}}" stepKey="cartAssertCartSimpleProduct1Price"/>
            <seeInField userInput="1" selector="{{CheckoutCartProductSection.ProductQuantityByName($$createSimpleProduct1.name$$)}}" stepKey="cartAssertCartSimpleProduct1Quantity"/>
            <click selector="{{CheckoutCartProductSection.ProductLinkByName($$createSimpleProduct1.name$$)}}" stepKey="cartClickCartSimpleProduct1" />
            <see userInput="$$createSimpleProduct1.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" stepKey="cartAssertAfterCartSimpleProduct1Name"/>
            <waitForElement selector="{{StorefrontMinicartSection.ProductLinkByName($$createSimpleProduct2.name$$)}}" stepKey="cartWaitForMinicartSimpleProduct21" />
            <click selector="{{StorefrontMinicartSection.ShowCart}}" stepKey="cartClickShowMinicart2" />
            <click selector="{{StorefrontMinicartSection.ViewAndEditCart}}" stepKey="cartClickViewAndEditCart" />
            <seeElement selector="{{CheckoutCartProductSection.ProductLinkByName($$createSimpleProduct2.name$$)}}" stepKey="cartAssertCartSimpleProduct2Name"/>
            <see userInput="$$$createSimpleProduct2.price$$.00" selector="{{CheckoutCartProductSection.ProductPriceByName($$createSimpleProduct2.name$$)}}" stepKey="cartAssertCartSimpleProduct2Price"/>
            <seeInField userInput="1" selector="{{CheckoutCartProductSection.ProductQuantityByName($$createSimpleProduct2.name$$)}}" stepKey="cartAssertCartSimpleProduct2Quantity"/>
            <click selector="{{CheckoutCartProductSection.ProductLinkByName($$createSimpleProduct2.name$$)}}" stepKey="cartClickCartSimpleProduct2" />
            <see userInput="$$createSimpleProduct2.name$$" selector="{{StorefrontProductInfoMainSection.productName}}" stepKey="cartAssertAfterCartSimpleProduct2Name"/>

            <!-- Step 4: User compares products -->
            <!-- Add Simple Product 1 to comparison -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="compareClickCategory"/>
            <click selector="{{StorefrontCategoryProductSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="compareClickSimpleProduct1"/>
            <scrollTo selector="{{StorefrontProductInfoMainSection.productAddToCompare}}" stepKey="compareScrollToAddSimpleProduct1ToCompare"/>
            <click selector="{{StorefrontProductInfoMainSection.productAddToCompare}}" stepKey="compareClickAddSimpleProduct1ToCompare"/>
            <waitForElement selector="{{StorefrontMessageSection.message('You added product $$createSimpleProduct1.name$$ to the comparison list.')}}" time="30" stepKey="compareMessageSimpleProduct1AddedToCompare"/>

            <!-- Add Simple Product 2 to comparison -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="compareClickCategory1" />
            <moveMouseOver selector="{{StorefrontCategoryProductSection.ProductInfoByName($$createSimpleProduct2.name$$)}}" stepKey="compareMoveMouseOverSimpleProduct2" />
            <click selector="{{StorefrontCategoryProductSection.ProductAddToCompareByName($$createSimpleProduct2.name$$)}}" stepKey="compareClickAddSimpleProduct2ToCompare"/>
            <waitForElement selector="{{StorefrontMessageSection.message('You added product $$createSimpleProduct2.name$$ to the comparison list.')}}" time="30" stepKey="compareMessageSimpleProduct2AddedToCompare"/>

            <!-- Check products in comparison sidebar -->
            <waitForElement selector="{{StorefrontComparisonSidebarSection.ProductTitleByName($$createSimpleProduct1.name$$)}}" stepKey="compareSimpleProduct1InSidebar"/>
            <waitForElement selector="{{StorefrontComparisonSidebarSection.ProductTitleByName($$createSimpleProduct2.name$$)}}" stepKey="compareSimpleProduct2InSidebar"/>

            <!-- Check products on comparison page -->
            <click selector="{{StorefrontComparisonSidebarSection.Compare}}" stepKey="compareClickCompare"/>
            <seeElement selector="{{StorefrontProductCompareMainSection.ProductLinkByName($$createSimpleProduct1.name$$)}}" stepKey="compareAssertCompareSimpleProduct1Name"/>
            <see userInput="$$$createSimpleProduct1.price$$.00" selector="{{StorefrontProductCompareMainSection.ProductPriceByName($$createSimpleProduct1.name$$)}}" stepKey="compareAssertCompareSimpleProduct1Price"/>
            <seeElement selector="{{StorefrontProductCompareMainSection.ProductLinkByName($$createSimpleProduct2.name$$)}}" stepKey="compareAssertCompareSimpleProduct2Name"/>
            <see userInput="$$$createSimpleProduct2.price$$.00" selector="{{StorefrontProductCompareMainSection.ProductPriceByName($$createSimpleProduct2.name$$)}}" stepKey="compareAssertCompareSimpleProduct2Price"/>

            <!-- Clear comparison sidebar -->
            <click selector="{{StorefrontHeaderSection.NavigationCategoryByName($$createCategory.name$$)}}" stepKey="compareClickCategoryBeforeClear"/>
            <waitForElementVisible selector="{{StorefrontComparisonSidebarSection.ClearAll}}" time="30" stepKey="compareWaitForClearAll"/>
            <click selector="{{StorefrontComparisonSidebarSection.ClearAll}}" stepKey="compareClickClearAll"/>
            <waitForElementVisible selector="{{ModalConfirmationSection.OkButton}}" time="30" stepKey="compareWaitForClearOk"/>
            <scrollTo selector="{{ModalConfirmationSection.OkButton}}" stepKey="compareClickClearOk"/>
            <click selector="{{ModalConfirmationSection.OkButton}}" stepKey="compareClickClearOk"/>
            <waitForElement selector="{{StorefrontMessageSection.message('You cleared the comparison list.')}}" time="30" stepKey="compareMessageCleared"/>
            <waitForElement selector="{{StorefrontComparisonSidebarSection.NoItemsMessage}}" time="30" stepKey="compareNoItems"/>

            <!-- Step 5: User uses coupon codes -->
            <amOnPage url="{{CheckoutCartPage}}" stepKey="couponOnCartPage"/>
            <click selector="{{StorefrontSalesRuleCartCouponSection.couponHeader}}" stepKey="couponClickCouponHeader" />
            <waitForElementVisible selector="{{StorefrontSalesRuleCartCouponSection.couponField}}" stepKey="couponWaitForCouponField" />
            <fillField userInput="$$createSalesRuleCoupon.code$$" selector="{{StorefrontSalesRuleCartCouponSection.couponField}}" stepKey="couponFillCouponField"/>
            <click selector="{{StorefrontSalesRuleCartCouponSection.applyButton}}" stepKey="couponClickApplyButton"/>
            <waitForElementVisible selector="{{StorefrontSalesRuleCartCouponSection.discountTotal}}" stepKey="couponWaitForDiscountTotal" />
            <!--<see userInput="$$createSalesRule.store_labels[0]['store_label']$$" selector="{{StorefrontSalesRuleCartCouponSection.discountLabel}}" stepKey="couponAssertDiscountLabel" />-->
            <see userInput="-$24.60" selector="{{StorefrontSalesRuleCartCouponSection.discountTotal}}" stepKey="couponAssertDiscountTotal" />



        </test>
    </cest>
</config>
